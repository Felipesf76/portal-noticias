<!-- Contenedor para Título y Botón -->
<div class="flex justify-center">
<div class="w-3/4 flex items-center gap-4 p-4 bg-gray-100 rounded-lg">
    <!-- Botón Agregar con efectos interactivos -->
    <button 
        mat-icon-button 
        color="primary" 
        (click)= "myModal.show()"
        aria-label="Agregar usuario"
        class="flex items-center gap-2 px-4 py-2 bg-gray-700 text-white font-bold rounded-full cursor-pointer hover:bg-gray-800">
        <mat-icon class="hover:text-blue-600 transition">add</mat-icon>
        <span>Nuevo</span>
    </button>
    
    <!-- Modal -->
    <dialog #myModal>

        <!-- Fondo Oscuro -->
        <div class="fixed inset-0 bg-gray-600 bg-opacity-30 flex justify-center items-center z-50">
        <!-- Modal -->
            <div class="bg-white p-6 rounded-lg shadow-lg w-96 relative">
        
                <!-- Botón Cerrar -->
                <button class="absolute top-2 right-2 text-red-500 hover:text-red-700" (click)="myModal.close()">
                    ❌
                </button>
                <!-- Formulario -->
                <h2 class="text-xl font-bold text-gray-700 mb-4">Agregar Usuario</h2>

                <form (ngSubmit)="onAdd()" #userForm="ngForm">
                    <!-- Nombre -->
                    <label class="block text-sm font-medium text-gray-700" >Nombre</label>
                    <input 
                    type="text" 
                    id="nombre" 
                    name="nombre" 
                    class="w-full p-2 border rounded-md mb-3" placeholder="Ingrese el nombre" 
                    #nombre="ngModel" [(ngModel)]="new_user.nombre" required
                    pattern="^(?!\s*$)[a-zA-Z0-9 ]+$"
                    />
                    <div *ngIf="!nombre.valid && nombre.touched" class="text-red-500 text-sm">
                        El nombre es incorrecto
                    </div>

                    <!-- Correo -->
                    <label class="block text-sm font-medium text-gray-700" >Correo</label>
                    <input 
                    type="text" 
                    id="correo" 
                    name="correo" 
                    class="w-full p-2 border rounded-md mb-3" placeholder="Ingrese el correo" 
                    #correo="ngModel" [(ngModel)]="new_user.correo" required
                    pattern="/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/"
                    />
                    <div *ngIf="!correo.valid && correo.touched" class="text-red-500 text-sm">
                        El correo es incorrecto
                    </div>

                    <!-- Usuario -->
                    <label class="block text-sm font-medium text-gray-700" >Usuario</label>
                    <input 
                    type="text" 
                    id="usuario" 
                    name="usuario" 
                    class="w-full p-2 border rounded-md mb-3" placeholder="Ingrese el usuario" 
                    #usuario="ngModel" [(ngModel)]="new_user.usuario" required
                    pattern="^(?!\s*$)[a-zA-Z0-9 ]+$"
                    />
                    <div *ngIf="!usuario.valid && usuario.touched" class="text-red-500 text-sm">
                        El usuario es incorrecto
                    </div>

                    <!-- Fecha Nacimiento -->
                    <label class="block text-sm font-medium text-gray-700">Fecha Nacimiento</label>
                    <input 
                    type="date"
                    id="fecha_nacimiento"
                    name="fecha_nacimiento"
                    #fecha_nacimiento="ngModel" [(ngModel)]="new_user.fecha_nacimiento"
                    required
                    (change)="validateDates()"
                    class="w-full p-2 border rounded-md mb-3" />
                    <div *ngIf="fechaNacimientoError" class="text-red-500 text-sm">
                        {{ fechaNacimientoError }}
                    </div>

                    <!-- Genero -->
                    <!--<label class="block text-sm font-medium text-gray-700">Selecciona una opción:</label>
                    <select id="sexo" formControlName="sexo">
                    <option value="" disabled>Selecciona...</option>
                    <option *ngFor="" [value]="">
                        
                    </option>
                    </select>-->
                    <!--<div *ngIf="!sexo.invalid && sexo.touched" class="text-red-500 text-sm"></div>
                        Este campo es obligatorio. -->

                    <!-- Botones -->
                    <div class="flex justify-between mt-5">
                        <button type="button" class="bg-gray-600 text-white px-4 py-2 rounded-md hover:bg-gray-700" (click)="myModal.close()" >CANCELAR</button>
                        
                        <button 
                            type="submit" 
                            [disabled]="userForm.invalid || customFormInvalid"
                            [ngClass]="{
                                'bg-blue-600 hover:bg-blue-700 transition duration-300': !userForm.invalid && !customFormInvalid,
                                'bg-gray-400 cursor-not-allowed': userForm.invalid || customFormInvalid
                            }"
                            class="px-4 py-2 rounded-md text-white"
                            >
                            GUARDAR
                        </button>

                    </div>
                </form>

            </div>
        </div>    
    </dialog>
</div>
</div>

<div class="flex justify-center">
<div class="w-3/4 overflow-x-auto bg-white shadow-md">
    <!-- <table class="w-full border-collapse border border-gray-300"> -->
        <table class="w-full border-collapse border border-gray-300 shadow-md text-center">
        <thead class="bg-gray-700 text-white">
            <tr>
                <th class="px-4 py-2 border">Nombre</th>
                <th class="px-4 py-2 border">Correo Electrónico</th>
                <th class="px-4 py-2 border">Usuario</th>
                <th class="px-4 py-2 border">Fecha nacimiento</th>
                <th class="px-4 py-2 border">Genero</th>
                <th class="px-4 py-2 border">Acciones</th>
            </tr>
        </thead>
        <tbody>
            @for (item of record_user; track $index) {
            <tr class="bg-gray-100">
                    <td class="px-4 py-2 border">{{item.nombre_completo}}</td>
                    <td class="px-4 py-2 border">{{item.corre}}</td>
                    <td class="px-4 py-2 border">{{item.nombre_usuario}}</td>
                    <td class="px-4 py-2 border">{{item.fecha_nacimiento | date: 'yyyy-MM-dd'}}</td>
                    <td class="px-4 py-2 border">{{item.sexo}}</td>
                    <td class="px-4 py-2 border">
                        <div class="flex flex-row justify-center space-x-2">
                            <!-- Botón de Editar -->
                            <button  mat-icon-button color="primary"
                            (click)="onEdit(item)" 
                            aria-label="Editar usuario"
                            class="transition transform active:scale-90 hover:bg-green-100 focus:ring focus:ring-blue-100 p-2 rounded-md cursor-pointer"
                            >  
                                <mat-icon >edit</mat-icon>
                            </button>
                            <!-- Botón de Eliminar -->
                            <button mat-icon-button color="warn"
                            (click)="onDelete(item)"
                            aria-label="Eliminar usuario"
                            class="transition transform active:scale-90 hover:bg-red-100 focus:ring focus:ring-blue-100 p-2 rounded-md cursor-pointer"
                            >
                                <mat-icon>delete</mat-icon>
                            </button>
                        </div>
                    </td>       
            </tr>
        }
        </tbody>
    </table>
</div>
</div>